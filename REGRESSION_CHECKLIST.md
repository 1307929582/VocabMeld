# VocabMeld 回归测试清单

> 本文档定义了每个重构阶段必须通过的测试点，确保功能不损坏

**版本**: 1.0
**创建日期**: 2025-12-16
**适用范围**: Phase 1-2重构期间的每次提交

---

## 测试分级

- 🔴 **Critical** - 必须通过，否则不能合并
- 🟡 **Important** - 应该通过，失败需要记录和计划修复
- 🟢 **Nice-to-have** - 可选，不影响合并

---

## 1. 构建验证（每次构建必测）

### 1.1 构建产物形态 🔴

```bash
npm run build
```

**检查点**：
- [ ] 构建成功，无错误
- [ ] `dist/`目录生成
- [ ] `dist/js/content.js`存在且为IIFE格式
  - 打开文件，确认开头是`(function(){...`或类似包裹
  - 搜索`import `和`export `，确认**不存在**
  - 搜索`import(`，确认**不存在**动态导入
- [ ] `dist/js/background.js`存在
- [ ] `dist/popup.html`和`dist/options.html`存在
- [ ] `dist/css/content.css`存在
- [ ] `dist/manifest.json`存在

### 1.2 Manifest路径一致性 🔴

打开`dist/manifest.json`，检查：

```json
{
  "background": {
    "service_worker": "js/background.js"  // ✓ 文件存在
  },
  "content_scripts": [{
    "js": ["js/content.js"],  // ✓ 文件存在
    "css": ["css/content.css"]  // ✓ 文件存在
  }],
  "action": {
    "default_popup": "popup.html"  // ✓ 文件存在
  },
  "options_page": "options.html"  // ✓ 文件存在
}
```

### 1.3 资源路径检查 🔴

```bash
# 检查HTML文件中的资源引用
grep -r "src=" dist/*.html
grep -r "href=" dist/*.html
```

- [ ] 所有路径都是相对路径（以`./`或不带`/`开头）
- [ ] 没有`/assets/...`这样的绝对路径

### 1.4 CSP安全检查 🔴

```bash
# 搜索可能的CSP违规代码
grep -r "eval(" dist/js/
grep -r "new Function" dist/js/
```

- [ ] 产物中**不包含**`eval(`或`new Function`

---

## 2. 扩展加载验证（集成前必测）

### 2.1 基础加载 🔴

1. 打开Chrome `chrome://extensions/`
2. 开启"开发者模式"
3. 点击"加载已解压的扩展程序"
4. 选择`dist/`目录

**检查点**：
- [ ] 扩展成功加载，无错误
- [ ] 扩展图标显示在工具栏
- [ ] 点击扩展图标，popup正常打开

### 2.2 控制台错误检查 🔴

1. 打开任意网页（如`https://www.example.com`）
2. 打开开发者工具（F12）
3. 查看Console标签

**检查点**：
- [ ] 无红色错误（语法错误、加载失败等）
- [ ] 可能有警告，但不应有Critical错误
- [ ] 看到VocabMeld的log（如"Content script loaded"）

---

## 3. 核心功能回归（每个Phase必测）

### 3.1 页面处理功能 🔴

**前置条件**：
- 打开一个包含英文/中文文本的网页
- 在popup或options中配置好API（可使用mock）

**测试步骤**：
1. 点击扩展popup中的"处理当前页面"按钮
2. 等待3-5秒

**检查点**：
- [ ] 页面上部分词汇被替换（有紫色虚线下划线）
- [ ] 替换后的词汇格式符合配置的样式
  - 默认："翻译(原文)"
  - 仅译文："翻译"
  - 原文在前："原文(翻译)"
- [ ] 页面布局没有被破坏
- [ ] Console无Critical错误

### 3.2 缓存功能 🔴

**测试步骤**：
1. 第一次处理页面后，记录处理的词汇数量（如5个）
2. 点击"恢复页面"
3. 再次点击"处理当前页面"
4. 观察处理速度

**检查点**：
- [ ] 第二次处理明显更快（毫秒级）
- [ ] 缓存命中率统计增加（在options->统计中查看）
- [ ] 词汇缓存数量正确（在options->已缓存词汇中查看）

### 3.3 Tooltip交互 🔴

**测试步骤**：
1. 鼠标悬停在已替换的词汇上
2. 观察tooltip显示

**检查点**：
- [ ] Tooltip正确显示
- [ ] 包含：翻译、难度徽章、音标（如果配置开启）
- [ ] 提示文字："左键点击发音 · 右键标记已学会"

### 3.4 发音功能 🟡

**测试步骤**：
1. 左键点击已替换的词汇

**检查点**：
- [ ] 触发TTS播报（听到声音或看到播报动作）
- [ ] Console无错误

### 3.5 标记已学会 🔴

**测试步骤**：
1. 右键点击已替换的词汇
2. 观察页面和存储变化

**检查点**：
- [ ] 词汇立即恢复为原文（不再显示翻译）
- [ ] 该词汇被添加到"已学会词汇"列表（options->已学会词汇）
- [ ] 刷新页面后，该词汇不再被替换

### 3.6 添加到需记忆 🔴

**测试步骤**：
1. 在页面上选中（双击或划选）一个未翻译的词汇
2. 点击弹出的"添加到需记忆"按钮
3. 观察页面变化

**检查点**：
- [ ] 选中的词汇被立即翻译并替换
- [ ] 该词汇被添加到"需记忆词汇"列表
- [ ] 显示toast提示"已添加到记忆列表并翻译"

---

## 4. 配置功能回归（Phase 1必测）

### 4.1 Popup功能 🔴

**测试步骤**：
1. 点击扩展图标打开popup
2. 测试开关切换
3. 点击"处理当前页面"
4. 点击"打开设置"

**检查点**：
- [ ] Popup正常打开，无白屏
- [ ] 开关状态与实际enabled状态同步
- [ ] 切换开关后，状态正确保存
- [ ] "处理当前页面"按钮正常触发处理
- [ ] "打开设置"正确打开options页面

### 4.2 Options页面加载 🔴

**测试步骤**：
1. 右键扩展图标，选择"选项"
2. 观察页面加载

**检查点**：
- [ ] Options页面正常打开，无白屏
- [ ] 所有配置项正确显示当前值
- [ ] 已学会词汇、需记忆词汇、已缓存词汇列表正确显示
- [ ] 统计数据正确显示

### 4.3 配置保存 🔴

**测试步骤**：
1. 修改任意配置项（如难度等级）
2. 关闭options页面
3. 重新打开options页面

**检查点**：
- [ ] 修改后的配置被正确保存
- [ ] 重新打开后，配置值保持修改后的状态

### 4.4 API测试功能 🟡

**测试步骤**：
1. 在options中填入API配置
2. 点击"测试连接"按钮

**检查点**：
- [ ] 显示测试结果（成功或失败）
- [ ] 如果失败，显示错误信息
- [ ] Console无Critical错误

---

## 5. 自动处理功能 🟡

### 5.1 自动处理开关

**测试步骤**：
1. 在options中开启"自动处理"
2. 打开一个新页面

**检查点**：
- [ ] 页面加载完成后，自动开始处理
- [ ] 词汇被自动替换

### 5.2 滚动触发

**测试步骤**：
1. 在长页面上滚动到底部
2. 观察新出现的内容

**检查点**：
- [ ] 滚动到视口的新内容被处理
- [ ] 不会重复处理已处理的内容

---

## 6. 边界情况测试 🟡

### 6.1 特殊页面

测试以下类型页面：
- [ ] 代码高亮页面（GitHub代码页面）- 代码块不应被处理
- [ ] 纯图片页面 - 不崩溃
- [ ] SPA应用（如Gmail）- 内容变化时能处理
- [ ] 包含iframe的页面 - 不崩溃

### 6.2 大量词汇

**测试步骤**：
1. 在长文章页面（如维基百科）测试
2. 观察性能和稳定性

**检查点**：
- [ ] 处理完成时间合理（<30秒）
- [ ] 页面不卡顿
- [ ] 内存占用合理（<200MB）

---

## 7. 数据持久化测试 🔴

### 7.1 配置持久化

**测试步骤**：
1. 修改配置并保存
2. 重新加载扩展（在`chrome://extensions/`点击刷新）
3. 重新打开options

**检查点**：
- [ ] 配置在扩展重载后仍然保持

### 7.2 词汇列表持久化

**测试步骤**：
1. 添加几个词汇到"已学会"和"需记忆"
2. 重新加载扩展
3. 查看词汇列表

**检查点**：
- [ ] 已学会词汇列表保持
- [ ] 需记忆词汇列表保持
- [ ] 缓存保持

---

## 8. 跨浏览器会话测试 🟡

**测试步骤**：
1. 配置并使用扩展
2. 完全关闭Chrome浏览器
3. 重新打开Chrome

**检查点**：
- [ ] 所有配置保持
- [ ] 缓存保持
- [ ] 词汇列表保持

---

## 测试报告模板

每次测试后，填写以下报告：

```markdown
## 测试报告 - [Phase名称] - [日期]

**构建版本**: [git commit hash]
**测试人**: [name]
**测试环境**: Chrome [version] / macOS [version]

### 通过的测试 ✅
- [列出通过的关键测试点]

### 失败的测试 ❌
- [列出失败的测试，包括错误信息]

### 待修复问题
- [ ] Issue #1: [描述]
- [ ] Issue #2: [描述]

### 备注
[其他观察到的问题或建议]
```

---

## 附录：快速冒烟测试

如果时间紧迫，至少执行以下最小测试集：

1. ✅ 构建成功
2. ✅ 扩展加载成功
3. ✅ Console无Critical错误
4. ✅ 处理页面功能正常
5. ✅ Popup打开正常
6. ✅ Options打开正常

通过这6项，可以确认基本功能未被破坏。
