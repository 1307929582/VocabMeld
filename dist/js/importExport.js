import"./chunks/modulepreload-polyfill-B5Qt9EMX.js";/* empty css                          */import{s as d}from"./chunks/storage-DOvsNEMd.js";function m(n,e,o){const t=`${(n||"").trim().toLowerCase()}|${e}|${o}`;let r=2166136261;for(let a=0;a<t.length;a++)r^=t.charCodeAt(a),r=r*16777619>>>0;return`w_${r.toString(16)}`}function u(n,e){return`${n}->${e}`}function g(n){const e=Date.now(),o=(n.original||"").trim(),t=n.sourceLang||"en",r=n.targetLang||"zh-CN",a=n.id||m(o,t,r),i=n.status||"learning",s=n.srs||{},l=typeof n.srsDueAt=="number"?n.srsDueAt:typeof s.dueAt=="number"?s.dueAt:e,c=n.stats||{};return{id:a,original:o,originalLower:o.toLowerCase(),translation:n.translation||"",phonetic:n.phonetic||"",difficulty:n.difficulty||"B1",sourceLang:t,targetLang:r,langPair:u(t,r),status:i,createdAt:n.createdAt||e,updatedAt:n.updatedAt||e,srsDueAt:l,srs:{dueAt:l,intervalDays:typeof s.intervalDays=="number"?s.intervalDays:0,ease:typeof s.ease=="number"?s.ease:2.5,reps:typeof s.reps=="number"?s.reps:0,lapses:typeof s.lapses=="number"?s.lapses:0,lastReviewedAt:typeof s.lastReviewedAt=="number"?s.lastReviewedAt:null},stats:{seenCount:typeof c.seenCount=="number"?c.seenCount:0,replaceCount:typeof c.replaceCount=="number"?c.replaceCount:0,lastSeenAt:typeof c.lastSeenAt=="number"?c.lastSeenAt:null}}}function h(n){return JSON.stringify({version:1,exportedAt:Date.now(),words:n.map(e=>w(e))},null,2)}function p(n){const o=[["id","original","translation","phonetic","difficulty","sourceLang","targetLang","status"].join(",")];for(const t of n){const r=[t.id,t.original,t.translation,t.phonetic,t.difficulty,t.sourceLang,t.targetLang,t.status].map(v);o.push(r.join(","))}return o.join(`
`)}function f(n){const e=JSON.parse(n);if(!e||!Array.isArray(e.words))throw new Error("Invalid JSON format");const o=[],t=[];for(let r=0;r<e.words.length;r++)try{t.push(y(e.words[r]))}catch(a){o.push({index:r,error:a.message})}return{records:t,errors:o}}function y(n){const e=String(n.original||"").trim(),o=String(n.sourceLang||"").trim(),t=String(n.targetLang||"").trim();if(!e)throw new Error("original is required");if(!o)throw new Error("sourceLang is required");if(!t)throw new Error("targetLang is required");if(e.length>100)throw new Error("original too long");return g({...n,original:e,sourceLang:o,targetLang:t})}function w(n){return{id:n.id,original:n.original,translation:n.translation,phonetic:n.phonetic,difficulty:n.difficulty,sourceLang:n.sourceLang,targetLang:n.targetLang,status:n.status,createdAt:n.createdAt,updatedAt:n.updatedAt}}function v(n){const e=n==null?"":String(n);return/[",\n]/.test(e)?`"${e.replace(/"/g,'""')}"`:e}class L{constructor(){this.init()}async init(){const e=localStorage.getItem("vocabmeld-theme")||"light";document.documentElement.setAttribute("data-theme",e);const o=document.getElementById("theme-toggle-io");o.textContent=e==="dark"?"â˜€ï¸":"ğŸŒ™",o.addEventListener("click",()=>{const r=document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark";document.documentElement.setAttribute("data-theme",r),localStorage.setItem("vocabmeld-theme",r),o.textContent=r==="dark"?"â˜€ï¸":"ğŸŒ™"}),await this.loadCounts(),this.bindEvents()}async loadCounts(){const e=await d.getConfig();document.getElementById("export-learned-count").textContent=(e.learnedWords||[]).length,document.getElementById("export-memorize-count").textContent=(e.memorizeList||[]).length;const o=await d.getLocal(["vocabmeld_word_cache"]);document.getElementById("export-cache-count").textContent=(o.vocabmeld_word_cache||[]).length}bindEvents(){document.getElementById("select-file-btn").addEventListener("click",()=>{document.getElementById("file-input").click()}),document.getElementById("file-input").addEventListener("change",o=>{const t=o.target.files[0];t&&this.handleFileSelect(t)});const e=document.getElementById("drop-zone");e.addEventListener("dragover",o=>{o.preventDefault(),e.classList.add("drag-over")}),e.addEventListener("dragleave",()=>{e.classList.remove("drag-over")}),e.addEventListener("drop",o=>{o.preventDefault(),e.classList.remove("drag-over");const t=o.dataTransfer.files[0];t&&this.handleFileSelect(t)}),document.getElementById("export-json-btn").addEventListener("click",()=>this.exportJSON()),document.getElementById("export-csv-btn").addEventListener("click",()=>this.exportCSV())}async handleFileSelect(e){const o=await e.text();try{if(e.name.endsWith(".json")){const t=f(o);this.showPreview(t)}else e.name.endsWith(".csv")&&this.showToast("CSVå¯¼å…¥åŠŸèƒ½å¼€å‘ä¸­","info")}catch(t){this.showToast("æ–‡ä»¶æ ¼å¼é”™è¯¯: "+t.message,"error")}}showPreview(e){const o=document.getElementById("import-preview"),t=document.getElementById("preview-content");t.innerHTML=`
      <p>æ‰¾åˆ° <strong>${e.records.length}</strong> ä¸ªè¯æ±‡</p>
      ${e.errors.length>0?`<p class="error">é”™è¯¯: ${e.errors.length} æ¡</p>`:""}
    `,o.classList.remove("hidden"),document.getElementById("confirm-import-btn").onclick=async()=>{await this.confirmImport(e.records)},document.getElementById("cancel-import-btn").onclick=()=>{o.classList.add("hidden")}}async confirmImport(e){this.showToast(`æˆåŠŸå¯¼å…¥ ${e.length} ä¸ªè¯æ±‡`,"success"),document.getElementById("import-preview").classList.add("hidden")}async exportJSON(){const e=await d.getConfig(),o=[];document.getElementById("export-learned").checked&&o.push(...e.learnedWords||[]),document.getElementById("export-memorize").checked&&o.push(...e.memorizeList||[]);const t=h(o);this.download(t,"vocabmeld-export.json","application/json"),this.showToast("å¯¼å‡ºæˆåŠŸ","success")}async exportCSV(){const e=await d.getConfig(),o=[];document.getElementById("export-learned").checked&&o.push(...e.learnedWords||[]);const t=p(o);this.download(t,"vocabmeld-export.csv","text/csv"),this.showToast("å¯¼å‡ºæˆåŠŸ","success")}download(e,o,t){const r=new Blob([e],{type:t}),a=URL.createObjectURL(r),i=document.createElement("a");i.href=a,i.download=o,i.click(),URL.revokeObjectURL(a)}showToast(e,o="info"){const t=document.createElement("div");t.className=`toast toast--${o}`,t.textContent=e,t.style.cssText="position:fixed;bottom:20px;right:20px;padding:12px 24px;background:var(--primary);color:white;border-radius:6px;box-shadow:var(--shadow-md);z-index:9999",document.body.appendChild(t),setTimeout(()=>{t.style.opacity="0",setTimeout(()=>t.remove(),300)},3e3)}}new L;
