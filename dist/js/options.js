import{A as v,s as d,C as L}from"./chunks/storage-Cbixxn9A.js";document.addEventListener("DOMContentLoaded",async()=>{let p;function s(a=500){clearTimeout(p),p=setTimeout(S,a)}const e={navItems:document.querySelectorAll(".nav-item"),sections:document.querySelectorAll(".settings-section"),presetBtns:document.querySelectorAll(".preset-btn"),apiEndpoint:document.getElementById("apiEndpoint"),apiKey:document.getElementById("apiKey"),modelName:document.getElementById("modelName"),toggleApiKey:document.getElementById("toggleApiKey"),testConnectionBtn:document.getElementById("testConnectionBtn"),testResult:document.getElementById("testResult"),nativeLanguage:document.getElementById("nativeLanguage"),targetLanguage:document.getElementById("targetLanguage"),difficultyLevel:document.getElementById("difficultyLevel"),selectedDifficulty:document.getElementById("selectedDifficulty"),intensityRadios:document.querySelectorAll('input[name="intensity"]'),autoProcess:document.getElementById("autoProcess"),showPhonetic:document.getElementById("showPhonetic"),translationStyleRadios:document.querySelectorAll('input[name="translationStyle"]'),blacklistInput:document.getElementById("blacklistInput"),whitelistInput:document.getElementById("whitelistInput"),wordTabs:document.querySelectorAll(".word-tab"),learnedList:document.getElementById("learnedList"),memorizeList:document.getElementById("memorizeList"),cachedList:document.getElementById("cachedList"),learnedTabCount:document.getElementById("learnedTabCount"),memorizeTabCount:document.getElementById("memorizeTabCount"),cachedTabCount:document.getElementById("cachedTabCount"),clearLearnedBtn:document.getElementById("clearLearnedBtn"),clearMemorizeBtn:document.getElementById("clearMemorizeBtn"),clearCacheBtn:document.getElementById("clearCacheBtn"),learnedFilters:document.getElementById("learnedFilters"),memorizeFilters:document.getElementById("memorizeFilters"),cachedFilters:document.getElementById("cachedFilters"),learnedSearchInput:document.getElementById("learnedSearchInput"),memorizeSearchInput:document.getElementById("memorizeSearchInput"),cachedSearchInput:document.getElementById("cachedSearchInput"),difficultyFilterBtns:document.querySelectorAll(".difficulty-filter-btn"),statTotalWords:document.getElementById("statTotalWords"),statTodayWords:document.getElementById("statTodayWords"),statLearnedWords:document.getElementById("statLearnedWords"),statMemorizeWords:document.getElementById("statMemorizeWords"),statCacheSize:document.getElementById("statCacheSize"),statHitRate:document.getElementById("statHitRate"),cacheProgress:document.getElementById("cacheProgress"),resetTodayBtn:document.getElementById("resetTodayBtn"),resetAllBtn:document.getElementById("resetAllBtn")};async function l(){const a=await d.getConfig();e.apiEndpoint.value=a.apiEndpoint||v.deepseek.endpoint,e.apiKey.value=a.apiKey||"",e.modelName.value=a.modelName||v.deepseek.model,e.nativeLanguage.value=a.nativeLanguage||"zh-CN",e.targetLanguage.value=a.targetLanguage||"en";const i=L.indexOf(a.difficultyLevel||"B1");e.difficultyLevel.value=i>=0?i:2,E();const n=a.intensity||"medium";e.intensityRadios.forEach(o=>{o.checked=o.value===n}),e.autoProcess.checked=a.autoProcess??!1,e.showPhonetic.checked=a.showPhonetic??!0;const t=a.translationStyle||"translation-original";e.translationStyleRadios.forEach(o=>{o.checked=o.value===t}),e.blacklistInput.value=(a.blacklist||[]).join(`
`),e.whitelistInput.value=(a.whitelist||[]).join(`
`),I(a),w(a)}let r=[],u=[],m=[];async function I(a){const i=a.learnedWords||[],n=a.memorizeList||[];r=i.map(c=>({original:c.original,word:c.word,addedAt:c.addedAt,difficulty:c.difficulty||"B1"})),u=n.map(c=>({original:c.word,word:"",addedAt:c.addedAt,difficulty:c.difficulty||"B1"})),e.learnedTabCount.textContent=i.length,e.memorizeTabCount.textContent=n.length,y(),h();const o=(await d.getLocal(["vocabmeld_word_cache"])).vocabmeld_word_cache||[];e.cachedTabCount.textContent=o.length,m=o.map(c=>{const[T]=c.key.split(":");return{original:T,word:c.translation,addedAt:c.timestamp,difficulty:c.difficulty||"B1",phonetic:c.phonetic||""}}),g()}function f(a,i,n){if(i.length===0){a.innerHTML='<div class="empty-list">暂无词汇</div>';return}a.innerHTML=i.map(t=>`
      <div class="word-item">
        <span class="word-original">${t.original}</span>
        ${t.word?`<span class="word-translation">${t.word}</span>`:""}
        ${t.difficulty?`<span class="word-difficulty difficulty-${t.difficulty.toLowerCase()}">${t.difficulty}</span>`:""}
        <span class="word-date">${B(t.addedAt)}</span>
        ${n!=="cached"?`<button class="word-remove" data-word="${t.original}" data-type="${n}">&times;</button>`:""}
      </div>
    `).join(""),a.querySelectorAll(".word-remove").forEach(t=>{t.addEventListener("click",()=>C(t.dataset.word,t.dataset.type))})}function y(){const a=(e.learnedSearchInput?.value||"").toLowerCase().trim(),i=document.querySelector('.difficulty-filter-btn.active[data-tab="learned"]')?.dataset.difficulty||"all";let n=r;a&&(n=n.filter(t=>t.original.toLowerCase().includes(a)||t.word&&t.word.toLowerCase().includes(a))),i!=="all"&&(n=n.filter(t=>t.difficulty===i)),e.learnedTabCount.textContent=`${n.length} / ${r.length}`,f(e.learnedList,n,"learned")}function h(){const a=(e.memorizeSearchInput?.value||"").toLowerCase().trim(),i=document.querySelector('.difficulty-filter-btn.active[data-tab="memorize"]')?.dataset.difficulty||"all";let n=u;a&&(n=n.filter(t=>t.original.toLowerCase().includes(a)||t.word&&t.word.toLowerCase().includes(a))),i!=="all"&&(n=n.filter(t=>t.difficulty===i)),e.memorizeTabCount.textContent=`${n.length} / ${u.length}`,f(e.memorizeList,n,"memorize")}function g(){const a=(e.cachedSearchInput?.value||"").toLowerCase().trim(),i=document.querySelector('.difficulty-filter-btn.active[data-tab="cached"]')?.dataset.difficulty||"all";let n=m;a&&(n=n.filter(t=>t.original.toLowerCase().includes(a)||t.word&&t.word.toLowerCase().includes(a))),i!=="all"&&(n=n.filter(t=>t.difficulty===i)),e.cachedTabCount.textContent=`${n.length} / ${m.length}`,f(e.cachedList,n,"cached")}function B(a){if(!a)return"";const i=new Date(a);return`${i.getMonth()+1}/${i.getDate()}`}async function C(a,i){if(i==="learned"){const t=((await d.getConfig()).learnedWords||[]).filter(o=>o.original!==a);await d.set({learnedWords:t}),l()}else if(i==="memorize"){const t=((await d.getConfig()).memorizeList||[]).filter(o=>o.word!==a);await d.set({memorizeList:t}),l()}}async function w(a){e.statTotalWords.textContent=a.totalWords||0,e.statTodayWords.textContent=a.todayWords||0,e.statLearnedWords.textContent=(a.learnedWords||[]).length,e.statMemorizeWords.textContent=(a.memorizeList||[]).length;const i=a.cacheHits||0,n=a.cacheMisses||0,t=i+n,o=t>0?Math.round(i/t*100):0;e.statHitRate.textContent=o+"%";const c=((await d.getLocal(["vocabmeld_word_cache"])).vocabmeld_word_cache||[]).length;e.statCacheSize.textContent=c,e.cacheProgress.style.width=c/2e3*100+"%"}async function S(){const a=e.apiKey.value.trim(),i={apiEndpoint:e.apiEndpoint.value.trim(),modelName:e.modelName.value.trim(),nativeLanguage:e.nativeLanguage.value,targetLanguage:e.targetLanguage.value,difficultyLevel:L[e.difficultyLevel.value],intensity:document.querySelector('input[name="intensity"]:checked').value,autoProcess:e.autoProcess.checked,showPhonetic:e.showPhonetic.checked,translationStyle:document.querySelector('input[name="translationStyle"]:checked').value,blacklist:e.blacklistInput.value.split(`
`).filter(n=>n.trim()),whitelist:e.whitelistInput.value.split(`
`).filter(n=>n.trim())};try{await d.set(i),await d.setLocal({apiKey:a}),console.log("[VocabMeld] Settings saved automatically")}catch(n){console.error("[VocabMeld] Failed to save settings:",n)}}function b(){[e.apiEndpoint,e.apiKey,e.modelName,e.blacklistInput,e.whitelistInput].forEach(t=>{t.addEventListener("blur",()=>s()),t.addEventListener("change",()=>s())}),[e.nativeLanguage,e.targetLanguage].forEach(t=>{t.addEventListener("change",()=>s(200))}),e.difficultyLevel.addEventListener("input",()=>s(200)),e.difficultyLevel.addEventListener("change",()=>s(200)),e.intensityRadios.forEach(t=>{t.addEventListener("change",()=>s(200))}),e.translationStyleRadios.forEach(t=>{t.addEventListener("change",()=>s(200))}),[e.autoProcess,e.showPhonetic].forEach(t=>{t.addEventListener("change",()=>s(200))})}function E(){const a=L[e.difficultyLevel.value];e.selectedDifficulty.textContent=a}function z(){e.navItems.forEach(i=>{i.addEventListener("click",n=>{n.preventDefault();const t=i.dataset.section;e.navItems.forEach(o=>o.classList.remove("active")),e.sections.forEach(o=>o.classList.remove("active")),i.classList.add("active"),document.getElementById(t).classList.add("active")})}),e.presetBtns.forEach(i=>{i.addEventListener("click",()=>{const n=v[i.dataset.preset];n&&(e.apiEndpoint.value=n.endpoint,e.modelName.value=n.model,e.presetBtns.forEach(t=>t.classList.remove("active")),i.classList.add("active"),s(200))})}),e.toggleApiKey.addEventListener("click",()=>{const i=e.apiKey.type==="password"?"text":"password";e.apiKey.type=i}),e.testConnectionBtn.addEventListener("click",async()=>{e.testConnectionBtn.disabled=!0,e.testResult.textContent="测试中...",e.testResult.className="test-result",chrome.runtime.sendMessage({action:"testApi",payload:{apiEndpoint:e.apiEndpoint.value,apiKey:e.apiKey.value,modelName:e.modelName.value}},i=>{e.testConnectionBtn.disabled=!1,i?.success?(e.testResult.textContent="✓ 连接成功",e.testResult.className="test-result success"):(e.testResult.textContent="✗ "+(i?.error||i?.message||"连接失败"),e.testResult.className="test-result error")})}),e.difficultyLevel.addEventListener("input",E),e.wordTabs.forEach(i=>{i.addEventListener("click",()=>{const n=i.dataset.tab;e.wordTabs.forEach(t=>t.classList.remove("active")),i.classList.add("active"),document.querySelectorAll(".word-list").forEach(t=>{t.classList.toggle("hidden",t.dataset.tab!==n)}),document.querySelectorAll(".word-filters").forEach(t=>{t.classList.toggle("hidden",t.dataset.tab!==n)})})});const a=document.querySelector(".word-tab.active");if(a){const i=a.dataset.tab;document.querySelectorAll(".word-filters").forEach(n=>{n.classList.toggle("hidden",n.dataset.tab!==i)})}e.learnedSearchInput&&e.learnedSearchInput.addEventListener("input",()=>{y()}),e.memorizeSearchInput&&e.memorizeSearchInput.addEventListener("input",()=>{h()}),e.cachedSearchInput&&e.cachedSearchInput.addEventListener("input",()=>{g()}),e.difficultyFilterBtns.forEach(i=>{i.addEventListener("click",()=>{const n=i.dataset.tab;document.querySelectorAll(`.difficulty-filter-btn[data-tab="${n}"]`).forEach(t=>{t.classList.remove("active")}),i.classList.add("active"),n==="learned"?y():n==="memorize"?h():n==="cached"&&g()})}),e.clearLearnedBtn.addEventListener("click",()=>{confirm("确定要清空所有已学会词汇吗？")&&chrome.runtime.sendMessage({action:"clearLearnedWords"},()=>{l(),s(200)})}),e.clearMemorizeBtn.addEventListener("click",()=>{confirm("确定要清空需记忆列表吗？")&&chrome.runtime.sendMessage({action:"clearMemorizeList"},()=>{l(),s(200)})}),e.clearCacheBtn.addEventListener("click",()=>{confirm("确定要清空词汇缓存吗？")&&chrome.runtime.sendMessage({action:"clearCache"},()=>{l(),s(200)})}),e.resetTodayBtn.addEventListener("click",async()=>{await d.set({todayWords:0}),l(),s(200)}),e.resetAllBtn.addEventListener("click",async()=>{confirm("确定要重置所有数据吗？这将清空所有统计和词汇列表。")&&(await d.set({totalWords:0,todayWords:0,cacheHits:0,cacheMisses:0,learnedWords:[],memorizeList:[]}),await d.setLocal({vocabmeld_word_cache:[]}),l(),s(200))}),b()}z(),l()});
