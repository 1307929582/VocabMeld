const c=["A1","A2","B1","B2","C1","C2"],n={openai:{name:"OpenAI",endpoint:"https://api.openai.com/v1/chat/completions",model:"gpt-4o-mini"},deepseek:{name:"DeepSeek",endpoint:"https://api.deepseek.com/chat/completions",model:"deepseek-chat"},moonshot:{name:"Moonshot",endpoint:"https://api.moonshot.cn/v1/chat/completions",model:"moonshot-v1-8k"},groq:{name:"Groq",endpoint:"https://api.groq.com/openai/v1/chat/completions",model:"llama-3.1-8b-instant"},ollama:{name:"Ollama (本地)",endpoint:"http://localhost:11434/v1/chat/completions",model:"qwen2.5:7b"}},o={apiEndpoint:n.deepseek.endpoint,apiKey:"",modelName:n.deepseek.model,nativeLanguage:"zh-CN",targetLanguage:"en",difficultyLevel:"B1",intensity:"medium",autoProcess:!1,showPhonetic:!0,enabled:!0,blacklist:[],whitelist:[],totalWords:0,todayWords:0,lastResetDate:new Date().toISOString().split("T")[0],cacheHits:0,cacheMisses:0};class r{constructor(){this.cache=null,this.listeners=new Map}async get(t=null){return new Promise(e=>{chrome.storage.sync.get(t,s=>{if(t===null)e({...o,...s});else if(typeof t=="string")e({[t]:s[t]??o[t]});else{const a={};t.forEach(i=>{a[i]=s[i]??o[i]}),e(a)}})})}async set(t){return new Promise((e,s)=>{chrome.storage.sync.set(t,()=>{chrome.runtime.lastError?s(chrome.runtime.lastError):e()})})}async getLocal(t=null){return new Promise(e=>{chrome.storage.local.get(t,s=>{e(s)})})}async setLocal(t){return new Promise((e,s)=>{chrome.storage.local.set(t,()=>{chrome.runtime.lastError?s(chrome.runtime.lastError):e()})})}async removeLocal(t){return new Promise(e=>{chrome.storage.local.remove(t,e)})}async getConfig(){const[t,e]=await Promise.all([this.get(null),this.getLocal(["apiKey"])]);return{...t,apiKey:e.apiKey||t.apiKey||""}}async updateStats(t){const e=await this.get(["totalWords","todayWords","lastResetDate","cacheHits","cacheMisses"]),s=new Date().toISOString().split("T")[0];e.lastResetDate!==s&&(e.todayWords=0,e.lastResetDate=s);const a={totalWords:e.totalWords+(t.newWords||0),todayWords:e.todayWords+(t.newWords||0),lastResetDate:s,cacheHits:e.cacheHits+(t.cacheHits||0),cacheMisses:e.cacheMisses+(t.cacheMisses||0)};return await this.set(a),a}async getWhitelist(){return(await this.get("learnedWords")).learnedWords||[]}async addToWhitelist(t){const e=await this.getWhitelist();e.some(a=>a.original===t.original||a.word===t.word)||(e.push({original:t.original,word:t.word,addedAt:Date.now()}),await this.set({learnedWords:e}))}async removeFromWhitelist(t){const s=(await this.getWhitelist()).filter(a=>a.original!==t&&a.word!==t);await this.set({learnedWords:s})}async getMemorizeList(){return(await this.get("memorizeList")).memorizeList||[]}async addToMemorizeList(t){const e=await this.getMemorizeList();e.some(a=>a.word===t)||(e.push({word:t,addedAt:Date.now()}),await this.set({memorizeList:e}))}async removeFromMemorizeList(t){const s=(await this.getMemorizeList()).filter(a=>a.word!==t);await this.set({memorizeList:s})}async isBlacklisted(t){const{blacklist:e}=await this.get("blacklist");return(e||[]).some(s=>t.includes(s))}async isWhitelisted(t){const{whitelist:e}=await this.get("whitelist");return(e||[]).some(s=>t.includes(s))}addChangeListener(t){const e=(s,a)=>{(a==="sync"||a==="local")&&t(s,a)};return chrome.storage.onChanged.addListener(e),()=>chrome.storage.onChanged.removeListener(e)}async getApiProfiles(){return(await this.get("apiProfiles")).apiProfiles||[]}async setApiProfiles(t){await this.set({apiProfiles:t})}async upsertApiProfile(t){const e=await this.getApiProfiles(),s=e.findIndex(a=>a.id===t.id);s>=0?e[s]={...t,updatedAt:Date.now()}:e.push({...t,createdAt:Date.now(),updatedAt:Date.now()}),await this.setApiProfiles(e)}async deleteApiProfile(t){const s=(await this.getApiProfiles()).filter(a=>a.id!==t);await this.setApiProfiles(s)}async getApiRouting(){return(await this.get("apiRouting")).apiRouting||{mode:"manual",selectedProfileId:null,fallbackOrder:[]}}async setApiRouting(t){await this.set({apiRouting:t})}async getApiKey(t){return t&&((await this.getLocal(["apiKeys"])).apiKeys||{})[t]?.key||null}async setApiKey(t,e,s){const i=(await this.getLocal(["apiKeys"])).apiKeys||{};i[t]={id:t,provider:s,key:e,createdAt:i[t]?.createdAt||Date.now(),updatedAt:Date.now()},await this.setLocal({apiKeys:i})}async getProfileHealth(t){return((await this.getLocal(["profileHealth"])).profileHealth||{})[t]||null}async updateProfileHealth(t,e){const a=(await this.getLocal(["profileHealth"])).profileHealth||{};a[t]={...a[t],...e,profileId:t},await this.setLocal({profileHealth:a})}}const d=new r;export{n as A,c as C,d as s};
