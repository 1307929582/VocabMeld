(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const d=["A1","A2","B1","B2","C1","C2"],n={openai:{name:"OpenAI",endpoint:"https://api.openai.com/v1/chat/completions",model:"gpt-4o-mini"},deepseek:{name:"DeepSeek",endpoint:"https://api.deepseek.com/chat/completions",model:"deepseek-chat"},moonshot:{name:"Moonshot",endpoint:"https://api.moonshot.cn/v1/chat/completions",model:"moonshot-v1-8k"},groq:{name:"Groq",endpoint:"https://api.groq.com/openai/v1/chat/completions",model:"llama-3.1-8b-instant"},ollama:{name:"Ollama (本地)",endpoint:"http://localhost:11434/v1/chat/completions",model:"qwen2.5:7b"}},a={apiEndpoint:n.deepseek.endpoint,apiKey:"",modelName:n.deepseek.model,nativeLanguage:"zh-CN",targetLanguage:"en",difficultyLevel:"B1",intensity:"medium",autoProcess:!1,showPhonetic:!0,enabled:!0,blacklist:[],whitelist:[],totalWords:0,todayWords:0,lastResetDate:new Date().toISOString().split("T")[0],cacheHits:0,cacheMisses:0};class l{constructor(){this.cache=null,this.listeners=new Map}async get(e=null){return new Promise(t=>{chrome.storage.sync.get(e,o=>{if(e===null)t({...a,...o});else if(typeof e=="string")t({[e]:o[e]??a[e]});else{const s={};e.forEach(i=>{s[i]=o[i]??a[i]}),t(s)}})})}async set(e){return new Promise((t,o)=>{chrome.storage.sync.set(e,()=>{chrome.runtime.lastError?o(chrome.runtime.lastError):t()})})}async getLocal(e=null){return new Promise(t=>{chrome.storage.local.get(e,o=>{t(o)})})}async setLocal(e){return new Promise((t,o)=>{chrome.storage.local.set(e,()=>{chrome.runtime.lastError?o(chrome.runtime.lastError):t()})})}async removeLocal(e){return new Promise(t=>{chrome.storage.local.remove(e,t)})}async getConfig(){const[e,t]=await Promise.all([this.get(null),this.getLocal(["apiKey"])]);return{...e,apiKey:t.apiKey||e.apiKey||""}}async updateStats(e){const t=await this.get(["totalWords","todayWords","lastResetDate","cacheHits","cacheMisses"]),o=new Date().toISOString().split("T")[0];t.lastResetDate!==o&&(t.todayWords=0,t.lastResetDate=o);const s={totalWords:t.totalWords+(e.newWords||0),todayWords:t.todayWords+(e.newWords||0),lastResetDate:o,cacheHits:t.cacheHits+(e.cacheHits||0),cacheMisses:t.cacheMisses+(e.cacheMisses||0)};return await this.set(s),s}async getWhitelist(){return(await this.get("learnedWords")).learnedWords||[]}async addToWhitelist(e){const t=await this.getWhitelist();t.some(s=>s.original===e.original||s.word===e.word)||(t.push({original:e.original,word:e.word,addedAt:Date.now()}),await this.set({learnedWords:t}))}async removeFromWhitelist(e){const o=(await this.getWhitelist()).filter(s=>s.original!==e&&s.word!==e);await this.set({learnedWords:o})}async getMemorizeList(){return(await this.get("memorizeList")).memorizeList||[]}async addToMemorizeList(e){const t=await this.getMemorizeList();t.some(s=>s.word===e)||(t.push({word:e,addedAt:Date.now()}),await this.set({memorizeList:t}))}async removeFromMemorizeList(e){const o=(await this.getMemorizeList()).filter(s=>s.word!==e);await this.set({memorizeList:o})}async isBlacklisted(e){const{blacklist:t}=await this.get("blacklist");return(t||[]).some(o=>e.includes(o))}async isWhitelisted(e){const{whitelist:t}=await this.get("whitelist");return(t||[]).some(o=>e.includes(o))}addChangeListener(e){const t=(o,s)=>{(s==="sync"||s==="local")&&e(o,s)};return chrome.storage.onChanged.addListener(t),()=>chrome.storage.onChanged.removeListener(t)}}const m=new l;export{n as A,d as C,m as s};
